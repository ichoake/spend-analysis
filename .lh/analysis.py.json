{
    "sourceFile": "analysis.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1749262639923,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1749262639923,
            "name": "Commit-0",
            "content": "#!/usr/bin/env python3\nimport argparse\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport logging\n\ndef parse_args():\n    parser = argparse.ArgumentParser(description=\"12-month spending analysis\")\n    parser.add_argument(\"input_csv\", help=\"Path to transactions CSV (must have date, amount, category)\")\n    return parser.parse_args()\n\ndef setup_logging():\n    logging.basicConfig(level=logging.INFO, format=\"%(levelname)s: %(message)s\")\n\ndef detect_date_column(df):\n    \"\"\"Detect the date column in the DataFrame.\"\"\"\n    for col in df.columns:\n        try:\n            parsed = pd.to_datetime(df[col], errors='coerce')\n            if parsed.notna().sum() > len(df) * 0.5:\n                logging.info(f\"Detected date column: '{col}'\")\n                return parsed\n        except Exception:\n            continue\n    raise ValueError(\"No suitable date column found.\")\n\ndef detect_amount_column(df):\n    \"\"\"Detect the first numeric column as the amount column.\"\"\"\n    num_cols = df.select_dtypes(include=['number']).columns\n    if not num_cols.empty:\n        logging.info(f\"Detected amount column: '{num_cols[0]}'\")\n        return pd.to_numeric(df[num_cols[0]], errors='coerce').fillna(0)\n    raise ValueError(\"No numeric column found for amounts.\")\n\ndef ensure_category_column(df):\n    \"\"\"Ensure a category column exists.\"\"\"\n    if 'category' not in df.columns:\n        logging.warning(\"No category column found. Assigning all as 'Uncategorized'.\")\n        df['category'] = 'Uncategorized'\n    return df['category']\n\ndef generate_reports(df):\n    \"\"\"Generate various spending reports.\"\"\"\n    # Prepare grouping columns\n    df['year_month'] = df['date'].dt.to_period('M').dt.to_timestamp()\n\n    # 1. Monthly spending by category\n    monthly = df.groupby(['year_month', 'category'])['amount'].sum().reset_index()\n    pivot = monthly.pivot(index='year_month', columns='category', values='amount').fillna(0)\n    pivot.to_csv('monthly_spending_by_category.csv')\n\n    # 2. Year-to-date (last 12 months) summary\n    latest = df['date'].max()\n    ytd = df[df['date'] >= (latest - pd.DateOffset(months=12))]\n    ytd_summary = ytd.groupby('category')['amount'].sum().reset_index()\n    ytd_summary.to_csv('year_to_date_spending_by_category.csv', index=False)\n\n    # 3. Cumulative spend\n    cum = df.groupby('date')['amount'].sum().cumsum().reset_index()\n    cum.to_csv('cumulative_spending.csv', index=False)\n\n    # 4. 3-month rolling average\n    rolling = pivot.rolling(window=3).mean().dropna()\n    rolling.to_csv('3mo_rolling_avg_by_category.csv')\n\n    # 5. Top 10 spending descriptions\n    desc_col = 'description' if 'description' in df.columns else df.columns[1]\n    top = df.groupby(desc_col)['amount'].sum().nlargest(10).reset_index()\n    top.columns = ['description', 'amount']\n    top.to_csv('top_10_spenders.csv', index=False)\n\n    # Print report summary\n    print(\"Generated reports:\")\n    for f in [\n        'monthly_spending_by_category.csv',\n        'year_to_date_spending_by_category.csv',\n        'cumulative_spending.csv',\n        '3mo_rolling_avg_by_category.csv',\n        'top_10_spenders.csv'\n    ]:\n        print('-', f)\n\n    # Optional: display plot for monthly spending\n    pivot.plot(title='Monthly Spending by Category')\n    plt.xticks(rotation=45)\n    plt.tight_layout()\n    plt.show()\n"
        }
    ]
}